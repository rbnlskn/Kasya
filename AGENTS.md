# Agent Guidelines
**Role:** You are Jules, an autonomous coding agent for the Kasya Project.

## 1. Project Overview
**Kasya (Personal Finance App)**
- **Tech Stack:** Ionic Capacitor (Web/Mobile Hybrid).
- **Environment:** Node.js, TypeScript.
- **Source of Truth:** `src/constants.ts` (contains `APP_VERSION` and `CHANGELOG`).

## 2. Work Process (Automated Batch Protocol)
You must check the labels on the Issue before acting.

### PLANNING STATE (Labels: `planning`, `jules`)
**Trigger:** You are woken up, and the issue has the `planning` and `jules` labels.
**Goal:** Create a robust plan for the user to review. **DO NOT WRITE CODE.**

1.  **Analyze:** Read the batch issue and all linked sub-issues to understand the full scope.
2.  **Plan:** Use the `set_plan` tool to define your proposed steps.
3.  **Communication:**
    -   Call `message_user` with a message like: "I have drafted a plan. Please review it and comment 'Approved' to proceed."
4.  **STOP:**
    -   **DO NOT** call `record_user_approval_for_plan`.
    -   **DO NOT** call `submit`.
    -   **DO NOT** start writing code or implementing changes.
    -   **DO NOT** mark the plan as complete.
    -   Simply end your turn and wait for the user to approve via the GitHub comment workflow.

### EXECUTION STATE (Labels: `in progress`, `jules`)
**Trigger:** You are woken up, and the issue has the `in progress` and `jules` labels.
1.  **Analyze:** Read the "Consolidated Context" in the issue body (generated by automation).
2.  **Plan:** Post a comment detailing exactly what you intend to do (files to touch, logic to change).
3.  **Execute:** Write the code to solve the sub-issues immediately. Do NOT wait for approval.
4.  **Versioning:**
    -   **Start of Batch:** Manually increment the **MINOR** version in `package.json` (e.g., `1.0.0` -> `1.1.0`). Reset the PATCH version to `0`.
    -   **During Development:** The `pre-commit` hook will automatically increment the **PATCH** version (e.g., `1.1.0` -> `1.1.1`) on every commit. Do not increment manually after the start.
    -   **Changelog:** Add a new entry to the `CHANGELOG` array in `src/constants.ts` for the MINOR version you just set.
        ```typescript
        { version: 'x.x.x', date: 'YYYY-MM-DD', changes: ['Description of change'] }
        ```
5.  **PR:** Open a Pull Request.
    -   **Important:** Link the Batch Issue in the PR description (e.g., "Fixes #123").
    -   Post a comment on the Batch Issue with the link to the PR (e.g., "PR Created: #456") or the text "pull request" to trigger the next phase.
    -   **Communication:** Jules must reply to **ALL** user comments on the PR, not just addressing code changes.

## 3. Pull Request Standards
When opening a Pull Request, you MUST follow this description format to ensure automation works correctly:

```markdown
## Summary
A brief paragraph describing the overall changes.

## Breakdown

### Issue #<id>
- Detailed bullet points of what was fixed or changed for this specific issue.

### Issue #<id>
- Changes for the next issue...
```
*Note: The `### Issue #<id>` headers are critical. The automation uses them to extract comments and close the specific sub-issues.*

## 4. PR Revision Protocol
If the user requests changes on your PR:
1.  **Acknowledge:** Post a comment acknowledging the feedback.
2.  **Plan:** Briefly state your revised plan to fix it.
3.  **Execute:** Push changes to the branch immediately.
4.  **Summarize:** Post a comment summarizing the changes made.

## 5. Batching Strategy
- **Multiple Issue Handling:** If the issue description references sub-issues (e.g., "Fixes #12"), solve ALL of them in this session.
